---
import Layout from "../../layouts/Layout.astro";
import { getExams } from "../../utils/sanity";

// Pagination parameters
const page = Number(Astro.url.searchParams.get('page') || 1);
const limit = 20;
const offset = (page - 1) * limit;

// Fetch exams for the current page
const exams = await getExams(limit, offset);

// We would need a separate query to get the total count for accurate pagination
// For now, we'll show next page button if we have a full page of results
const hasNextPage = exams.length === limit;

// Exam type map for display
const examTypeMap = {
  vbe: 'Valstybinis brandos egzaminas',
  mbe: 'Mokyklinis brandos egzaminas',
  trial: 'Bandomasis egzaminas',
  other: 'Kitas egzaminas'
};
---

<Layout title="Egzaminai">
  <div class="exams-page">
    <header class="page-header">
      <h1 class="page-title">Chemijos egzaminai</h1>
      <p class="page-description">
        Brandos egzaminų užduotys ir atsakymai. Ruoškitės egzaminams efektyviai!
      </p>
    </header>

    <div class="table-container">
      <table class="exams-table">
        <thead>
          <tr>
            <th>Pavadinimas</th>
            <th>Tipas</th>
            <th>Data</th>
            <th>Užduotys</th>
            <th>Atsakymai</th>
          </tr>
        </thead>
        <tbody>
          {exams.length ? (
            exams.map((exam) => (
              <tr>
                <td class="exam-title">{exam.title}</td>
                <td>{examTypeMap[exam.examType as keyof typeof examTypeMap] || exam.examType}</td>
                <td>
                  {exam.examDate
                    ? new Date(exam.examDate).toLocaleDateString('lt-LT')
                    : ''}
                </td>
                <td>
                  {exam.questionsFile && (
                    <a
                      href={exam.questionsFile.asset.url}
                      class="download-button download-button--questions"
                      target="_blank"
                      rel="noopener noreferrer"
                    >
                      Užduotys
                    </a>
                  )}
                </td>
                <td>
                  {exam.answersFile && (
                    <a
                      href={exam.answersFile.asset.url}
                      class="download-button download-button--answers"
                      target="_blank"
                      rel="noopener noreferrer"
                    >
                      Atsakymai
                    </a>
                  )}
                </td>
              </tr>
            ))
          ) : (
            <tr>
              <td colspan="5" class="empty-message">Nėra egzaminų.</td>
            </tr>
          )}
        </tbody>
      </table>
    </div>

    <div class="pagination">
      {page > 1 && (
        <a href={`/egzaminai?page=${page - 1}`} class="pagination-button">
          ← Ankstesnis puslapis
        </a>
      )}
      
      {hasNextPage && (
        <a href={`/egzaminai?page=${page + 1}`} class="pagination-button">
          Kitas puslapis →
        </a>
      )}
    </div>
  </div>
</Layout>
