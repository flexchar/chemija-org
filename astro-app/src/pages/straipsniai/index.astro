---
import Layout from "../../layouts/Layout.astro";
import ArticleCard from "../../components/ArticleCard.astro";
import { getArticles, type Article } from "../../utils/sanity";

// Pagination parameters
const page = Number(Astro.url.searchParams.get('page') || 1);
const limit = 8;
const offset = (page - 1) * limit;

// Fetch articles for the current page
const articles = await getArticles(limit, offset);

// We would need a separate query to get the total count for accurate pagination
// For now, we'll show next page button if we have a full page of results
const hasNextPage = articles.length === limit;
---

<Layout title="Straipsniai">
  <div class="articles-page">
    <header class="page-header">
      <h1 class="page-title">Straipsniai</h1>
      <p class="page-description">
        Naujausi chemijos mokslo straipsniai ir mokomoji medžiaga
      </p>
    </header>

    <div class="articles-grid">
      {articles.length ? (
        articles.map((article: Article) => <ArticleCard article={article} />)
      ) : (
        <p class="empty-message">Nėra straipsnių.</p>
      )}
    </div>

    <div class="pagination">
      {page > 1 && (
        <a href={`/straipsniai?page=${page - 1}`} class="pagination-button">
          ← Ankstesnis puslapis
        </a>
      )}
      
      {hasNextPage && (
        <a href={`/straipsniai?page=${page + 1}`} class="pagination-button">
          Kitas puslapis →
        </a>
      )}
    </div>
  </div>
</Layout>
