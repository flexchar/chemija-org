---
import { getArticles } from '@/utils/sanity';
import { urlFor } from '@/utils/image';
import Layout from '@/layouts/Layout.astro';
import { formatDate } from '@/utils/index';
import PortableText from '@/components/PortableText.astro';

// Define getStaticPaths to generate all article routes at build time
export async function getStaticPaths() {
    const articles = await getArticles(Number.MAX_SAFE_INTEGER); // Get all articles

    return articles.map((article) => ({
        params: { slug: article.slug!.current },
        props: { article },
    }));
}

// Get the article from props
const { article } = Astro.props;
const articleData = article;
---

<Layout title={articleData.title || 'Straipsnis'}>
    <article class="max-w-[900px] mx-auto px-6 sm:px-12 py-16">
        <!-- Back link -->
        <a
            href="/straipsniai"
            class="inline-flex items-center gap-2 text-xs font-medium tracking-wider uppercase text-neutral-500 hover:text-black transition-colors mb-12"
            style="font-family: 'IBM Plex Mono', monospace; letter-spacing: 0.05em;"
        >
            ← ATGAL
        </a>

        <header class="mb-16">
            <!-- Categories -->
            {
                articleData.categories && (
                    <div class="flex gap-2 mb-6">
                        {articleData.categories.map((category, index) => {
                            const accentColors = [
                                '#10B981',
                                '#3B82F6',
                                '#8B5CF6',
                                '#F59E0B',
                                '#EF4444',
                            ];
                            const accentColor =
                                accentColors[index % accentColors.length];
                            return (
                                <span
                                    class="text-xs font-medium tracking-wider uppercase px-3 py-1"
                                    style={`font-family: 'IBM Plex Mono', monospace; letter-spacing: 0.05em; background: ${accentColor}20; color: ${accentColor}; border-radius: 4px;`}
                                >
                                    {category.title}
                                </span>
                            );
                        })}
                    </div>
                )
            }

            <!-- Title -->
            <h1
                class="text-3xl sm:text-4xl font-medium leading-tight tracking-wide uppercase mb-6 text-neutral-900"
                style="font-family: 'IBM Plex Mono', monospace; letter-spacing: 0.02em;"
            >
                {articleData.title}
            </h1>

            <div class="h-px bg-neutral-200 mb-6"></div>

            <!-- Metadata -->
            <div class="flex flex-wrap items-center gap-4 text-xs text-neutral-500">
                <span>Paskelbta: {formatDate(articleData._createdAt)}</span>
                <span class="text-neutral-300">•</span>
                <span>Atnaujinta: {formatDate(articleData._updatedAt)}</span>
                <span class="text-neutral-300">•</span>
                <span>{articleData.views || 0} peržiūrų</span>
            </div>
        </header>

        <!-- Main Image -->
        {
            articleData.mainImage?.asset && (
                <div class="mb-16 border border-neutral-200" style="border-radius: 4px; overflow: hidden;">
                    <img
                        src={urlFor(articleData.mainImage?.asset)
                            .width(900)
                            .url()}
                        alt={articleData.title || 'Article image'}
                        class="w-full h-auto object-cover"
                    />
                </div>
            )
        }

        <!-- Content -->
        <div
            class="prose prose-neutral prose-headings:font-medium prose-headings:tracking-wide prose-headings:uppercase prose-p:leading-relaxed prose-a:underline hover:prose-a:text-neutral-600 prose-strong:text-neutral-900 prose-li:text-neutral-700 max-w-none"
            style="font-family: 'Inter', system-ui, sans-serif;"
        >
            <PortableText value={articleData.body!} />
        </div>
    </article>
</Layout>
