---
import Layout from '@/layouts/Layout.astro';
import ArticleCard from '@/components/ArticleCard.astro';
import { getArticles, getArticlesCount } from '@/utils/sanity';

// --- Page 1 Specific Logic ---
const page = 1; // This page always represents page 1
const limit = 20;
const offset = 0; // Always fetch the first set of articles

// Fetch articles for the first page
const articles = await getArticles(limit, offset);

// Get total count of articles for pagination calculation
const totalArticles = await getArticlesCount();
const totalPages = Math.ceil(totalArticles / limit);

// --- Pagination Logic (Remains largely the same, but link generation changes) ---
const paginationItems = [];
if (totalPages <= 5) {
    for (let i = 1; i <= totalPages; i++) {
        paginationItems.push(i);
    }
} else {
    // Always show the first 5 pages when on page 1
    paginationItems.push(1, 2, 3, 4, 5);
}
// Note: The logic for 'middle' and 'last few pages' isn't needed here
// because this file *only* handles page 1.
// The dynamic route [page].astro will handle those cases.
---

<Layout title="Straipsniai">
    <div class="max-w-[1400px] mx-auto px-6 sm:px-12 py-16">
        <header class="mb-12">
            <h1
                class="text-2xl sm:text-3xl font-medium tracking-wider uppercase mb-4"
                style="font-family: 'IBM Plex Mono', monospace; letter-spacing: 0.1em;"
            >
                STRAIPSNIAI
            </h1>
            <div class="h-px bg-neutral-200"></div>
            <p class="mt-6 text-sm text-neutral-600 max-w-2xl">
                Visi straipsniai apie chemiją, organines medžiagas ir kitų gamtos mokslų temas.
            </p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {
                articles.map((article, index) => {
                    const accentColors = [
                        '#10B981',
                        '#3B82F6',
                        '#8B5CF6',
                        '#F59E0B',
                        '#EF4444',
                    ];
                    const accentColor =
                        accentColors[index % accentColors.length];
                    return <ArticleCard article={article} accentColor={accentColor} />;
                })
            }
        </div>

        {
            totalPages > 1 && (
                <div class="flex justify-center items-center gap-2 mt-16">
                    {paginationItems.map((pageNum) => (
                        <a
                            href={
                                pageNum === 1
                                    ? `/straipsniai`
                                    : `/straipsniai/${pageNum}`
                            }
                            class={`px-4 py-2 text-xs font-medium tracking-wider uppercase border transition-colors ${
                                pageNum === page
                                    ? 'bg-black text-white border-black'
                                    : 'bg-white text-black border-neutral-200 hover:border-black'
                            }`}
                            style="font-family: 'IBM Plex Mono', monospace; letter-spacing: 0.05em; border-radius: 4px;"
                        >
                            {pageNum}
                        </a>
                    ))}

                    {page < totalPages && (
                        <a
                            href={`/straipsniai/2`}
                            class="px-4 py-2 text-xs font-medium tracking-wider uppercase bg-white text-black border border-neutral-200 hover:border-black transition-colors"
                            style="font-family: 'IBM Plex Mono', monospace; letter-spacing: 0.05em; border-radius: 4px;"
                        >
                            ›
                        </a>
                    )}

                    {page < totalPages && (
                        <a
                            href={`/straipsniai/${totalPages}`}
                            class="px-4 py-2 text-xs font-medium tracking-wider uppercase bg-white text-black border border-neutral-200 hover:border-black transition-colors"
                            style="font-family: 'IBM Plex Mono', monospace; letter-spacing: 0.05em; border-radius: 4px;"
                        >
                            »
                        </a>
                    )}
                </div>
            )
        }
    </div>
</Layout>
